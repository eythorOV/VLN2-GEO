
{% extends "base.html" %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/menu.css' %}">
    <h1 class="title_menu">Menu</h1>

    <div class="search_bar">
        <input id="text_field" type="text" placeholder="Search for a pizza...">
        <button class="search_button">Search</button>
    </div>
    <div class="pizza_filter">
        <button class="filter_button all" data-all="all">All</button>
        <button class="filter_button spicy" data-spicy="spicy">Spicy</button>
        <button class="filter_button vegan" data-vegan="vegan">Vegan</button>
        <button class="filter_button desert" data-desert="desert">Desert</button>
        <button class="filter_button popular" data-popular="popular">Popular</button>
        <span class="order_by">Order by:
            <button class="order_button" id="name">Name</button>
            <button class="order_button" id="price">Price</button>
        </span>
    </div>
    
    <div class="menu_container">

        {% for pizza in pizzas %}
            {% include 'menu/single_pizza.html' with pizza=pizza %}
        {% endfor %}


      </div>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <script>
      // Get all filter buttons
      const filterButtons = document.querySelectorAll('.filter_button');
      
      // Add event listener to each filter button
      filterButtons.forEach(button => {
          button.addEventListener('click', () => {
              const filterType = button.classList[1]; // Get the class name of the filter button
      
              // Show or hide pizzas based on the selected filter
              const pizzas = document.querySelectorAll('.block');
              pizzas.forEach(pizza => {
                  const isSpicy = pizza.dataset.spicy === 'true';
                  const isVegan = pizza.dataset.vegan === 'true';
                  const isDesert = pizza.dataset.desert === 'true';
                  const isPopular = pizza.dataset.popular === 'true';
      
                  if (
                      filterType === 'all' ||
                      (filterType === 'spicy' && isSpicy) ||
                      (filterType === 'vegan' && isVegan) ||
                      (filterType === 'desert' && isDesert) ||
                      (filterType === 'popular' && isPopular)
                  ) {
                      pizza.style.display = 'block';
                  } else {
                      pizza.style.display = 'none';
                  }
              });
          });
      });
      
      // Get the name and price buttons
      const nameButton = document.getElementById('name');
      const priceButton = document.getElementById('price');
      
      // Add event listener to the name button
      nameButton.addEventListener('click', () => {
          const pizzas = document.querySelectorAll('.block');
          const sortedPizzas = Array.from(pizzas).sort((a, b) => {
              const nameA = a.querySelector('#pizza_name').textContent.toLowerCase();
              const nameB = b.querySelector('#pizza_name').textContent.toLowerCase();
              return nameA.localeCompare(nameB);
          });
          displaySortedPizzas(sortedPizzas);
      });
      
      // Add event listener to the price button
      priceButton.addEventListener('click', () => {
          const pizzas = document.querySelectorAll('.block');
          const sortedPizzas = Array.from(pizzas).sort((a, b) => {
              const priceA = parseFloat(a.querySelector('#pizza_price').textContent.replace(/[^0-9.-]+/g, ''));
              const priceB = parseFloat(b.querySelector('#pizza_price').textContent.replace(/[^0-9.-]+/g, ''));
              return priceA - priceB;
          });
          displaySortedPizzas(sortedPizzas);
      });
      
      // Helper function to display sorted pizzas
      function displaySortedPizzas(pizzas) {
          const menuContainer = document.querySelector('.menu_container');
          menuContainer.innerHTML = ''; // Clear the current menu container
      
          pizzas.forEach(pizza => {
              menuContainer.appendChild(pizza);
          });
      }

      // Get the search input and search button
const searchInput = document.getElementById('text_field');
const searchButton = document.querySelector('.search_button');

// Add event listener to the search button
searchButton.addEventListener('click', () => {
    const searchTerm = searchInput.value.toLowerCase().trim();
    searchPizzas(searchTerm);
});

// Function to search and display pizzas based on the search term
function searchPizzas(searchTerm) {
    const pizzas = document.querySelectorAll('.block');
    pizzas.forEach(pizza => {
        const pizzaName = pizza.querySelector('#pizza_name').textContent.toLowerCase();
        if (pizzaName.includes(searchTerm)) {
            pizza.style.display = 'block';
        } else {
            pizza.style.display = 'none';
        }
    });
}

// $(document).ready(function() {
//         // Retrieve the CSRF token from the cookie
//         function getCookie(name) {
//             var cookieValue = null;
//             if (document.cookie && document.cookie !== '') {
//                 var cookies = document.cookie.split(';');
//                 for (var i = 0; i < cookies.length; i++) {
//                     var cookie = cookies[i].trim();
//                     // Does this cookie string begin with the name we want?
//                     if (cookie.substring(0, name.length + 1) === (name + '=')) {
//                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
//                         break;
//                     }
//                 }
//             }
//             return cookieValue;
//         }

//         // Add to cart button click event
//         $('.add_to_cart').click(function() {
//             var pizzaId = $(this).closest('.block').data('pizza-id');
//             var quantity = $(this).closest('.bottom_block').find('#quantity').val();

//             // Send AJAX request to add the item to the cart
//             $.ajax({
//                 type: 'POST',
//                 url: '/cart/',
//                 data: {
//                     'pizza_id': pizzaId,
//                     'quantity': quantity,
//                     'csrfmiddlewaretoken': getCookie('csrftoken')  // Include the CSRF token
//                 },
//                 success: function(response) {
//                     // Handle the success response, e.g., display a success message
//                     alert('Item added to the cart!');
//                 },
//                 error: function(xhr, errmsg, err) {
//                     // Handle the error response, e.g., display an error message
//                     console.log(xhr.status + ': ' + xhr.responseText);
//                 }
//             });
//         });

//         // Other JavaScript code for filtering and sorting pizzas
//     });

    </script>      
{% endblock %}